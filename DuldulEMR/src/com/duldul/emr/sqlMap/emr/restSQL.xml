<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Rest">
	<select id="getRest" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT * FROM(
	    SELECT ROWNUM AS NO,REPORTING,TERM,R_REASON,R_CHECK FROM(
      	SELECT TO_CHAR(R.REPORTING,'YYYY-MM-DD') AS REPORTING, TO_CHAR(R.START_DATE,'YYYY-MM-DD') || ' ~ ' || TO_CHAR(R.END_DATE,'YYYY-MM-DD') AS TERM,
      	R.R_REASON,C.CODE_NAME AS R_CHECK
     	FROM REST R LEFT OUTER JOIN(SELECT * FROM CODEDATA WHERE BIG='11')C
     	ON R.R_CHECK = C.SMALL
      	WHERE 1=1
      	AND EMP_NUM = #EMP_NUM#
        AND HOSPITAL_CODE = #HOSPITAL_CODE#
	    ORDER BY REPORTING DESC))
	    WHERE NO BETWEEN #start# AND #end#
	</select>
	<select id="getRestCount" parameterClass="java.util.HashMap" resultClass="Integer">
		SELECT COUNT(*) AS CNT
		FROM REST
		WHERE 1=1
	</select>
	<select id="getRestList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	    SELECT * FROM(
    	SELECT ROWNUM AS NUM,ENU,ENA,POTION,OFFS,TERM,R_REASON FROM(
      	SELECT SI.EMP_NUM AS ENU,SI.EMP_NAME AS ENA, SI.POSITION AS POTION, SI.OFFICE AS OFFS,TO_CHAR(R.START_DATE,'YYYY-MM-DD') || ' ~ ' || TO_CHAR(R.END_DATE,'YYYY-MM-DD') AS TERM,R.R_REASON
	    FROM REST R LEFT OUTER JOIN(
	    SELECT E.EMP_NUM,E.EMP_NAME,C.CODE_NAME AS POSITION, C1.CODE_NAME AS OFFICE
	    FROM EMP E LEFT OUTER JOIN(SELECT * FROM CODEDATA WHERE BIG='8')C
	    ON E.POSITION_CODE = C.SMALL
	    LEFT OUTER JOIN(SELECT * FROM CODEDATA WHERE BIG='9')C1
	    ON E.OFFICE_CODE = C1.SMALL
	    )SI
	    ON R.EMP_NUM = SI.EMP_NUM
	    <isNotEmpty property="rest_sea">
	    WHERE TO_DATE(TO_CHAR(R.START_DATE,'YYYY-MM-DD'),'YYYY-MM-DD') &lt;= TO_DATE(#rest_sea#,'YYYY-MM-DD')
      	AND TO_DATE(TO_CHAR(R.END_DATE,'YYYY-MM-DD'),'YYYY-MM-DD') &gt;= TO_DATE(#rest_sea#,'YYYY-MM-DD')     
		</isNotEmpty>
    	ORDER BY TERM DESC))    	
    	WHERE 1=1
    	AND NUM BETWEEN #start# AND #end#
	</select>
	<insert id="restInsert" parameterClass="java.util.HashMap">
		INSERT INTO DULDUL.REST(SERIAL_NUM,REPORTING,START_DATE,END_DATE,R_REASON,EMP_NUM,HOSPITAL_CODE)
		VALUES(REST_NUMBER.NEXTVAL,SYSDATE,#sdate#,#edate#,#reason#,#nums#,#hospital#)
	</insert>
</sqlMap>