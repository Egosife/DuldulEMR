<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Bbs">
	<select id="getBbs" 
			parameterClass="java.util.HashMap"
			resultClass="java.util.HashMap">
	SELECT SERIAL_NUM,POST_NUM,TITLE,WRITER,REPORTING,VIEWS
	FROM ((SELECT ROW_NUMBER() OVER(ORDER BY POST_NUM DESC)AS RNUM,SERIAL_NUM,POST_NUM,TITLE,WRITER,TO_CHAR(REPORTING, 'YYYY-MM-DD') AS REPORTING,VIEWS
      FROM POST
      WHERE 1=1 AND SEG_CODE = #gbn#
    <isNotEmpty property="searchText">
			AND TITLE LIKE '%' || #searchText# || '%'
	</isNotEmpty>
    	)A)
      	WHERE A.RNUM BETWEEN #start# AND #end#
	</select>
	<!-- 검색 및 글번호 순서대로 나오는 -->
	
		<select id="getBbsCount" 
			parameterClass= "java.util.HashMap"
			resultClass = "Integer">
		SELECT COUNT(*) AS CNT
		FROM POST
		WHERE 1 = 1 AND SEG_CODE = #gbn#
		<isNotEmpty property="searchText">
			AND TITLE LIKE '%' || #searchText# || '%'
		</isNotEmpty>
	</select>
	
	<select id="getBbsCon" 
			parameterClass="java.util.HashMap" 
			resultClass="java.util.HashMap">
		    SELECT P.SERIAL_NUM, P.TITLE, F.FILE_NAME,P.WRITER, TO_CHAR(P.REPORTING, 'YYYY-MM-DD') AS REPORTING,P.CONTENT
    		FROM POST P LEFT OUTER JOIN FILEUPLOAD F
                             ON P.SERIAL_NUM = F.SERIAL_NUM
    		WHERE P.SERIAL_NUM = #POST_NUM#	
	</select>
	
	<insert id="insertTest"
			parameterClass="java.util.HashMap">
		INSERT INTO POST(SERIAL_NUM,   EMP_NUM, HOSPITAL_CODE,  SEG_CODE,  POST_NUM,  TITLE,   CONTENT, REPORTING, WRITER)
		VALUES (POSTING_NUMBER.NEXTVAL,#empNo#, #hospitalCode#, #gbn#, #MAX_POSTNUM#, #postTitle#, #postCon# ,SYSDATE, #write#)
	</insert>
	 
	<!-- 글번호 --> 
 	<select id="getMaxPOST_Count" 
			parameterClass="java.util.HashMap" 
			resultClass="java.util.HashMap">
		SELECT MAX(POST_NUM)+1 AS MAX_POSTNUM 
		FROM POST 
		WHERE 1 = 1
		AND SEG_CODE = #gbn# 
		AND HOSPITAL_CODE = #hospitalCode#
	</select>
	
	
	<!-- 삭제 디비 -->
	<delete id="deleteTest"
			parameterClass="java.util.HashMap">
		DELETE FROM POST
		WHERE SERIAL_NUM = #POST_NUM#
	</delete>
	<!-- 수정 디비 -->
	<update  id="updateTest"
			parameterClass="java.util.HashMap">
		UPDATE POST SET TITLE = #postTitle#,
						CONTENT = #content#,
						FILE_NAME = #FileText#
		WHERE POST_NUM = #POST_NUM#
	</update>
	<!-- 조회수 디비 -->
	<update  id="visit"
			parameterClass="java.util.HashMap">
		UPDATE POST SET VIEWS = VIEWS + 1
		WHERE SERIAL_NUM = #POST_NUM#
	</update>
</sqlMap>